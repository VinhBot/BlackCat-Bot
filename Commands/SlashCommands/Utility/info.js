const { PermissionFlagsBits, EmbedBuilder, ActionRowBuilder, ButtonBuilder, ModalBuilder, TextInputBuilder, ApplicationCommandOptionType, ChannelType, ButtonStyle, TextInputStyle, ComponentType } = require("discord.js");

module.exports = {
  name: "info",
  description: "Nh·∫≠n th√¥ng tin v·ªÅ m·ªôt th·ª© g√¨ ƒë√≥",
  cooldown: 3,
  options: [{
      name: "invite",
      description: "nh·∫≠n th√¥ng tin v·ªÅ ng∆∞·ªùi d√πng",
      type: ApplicationCommandOptionType.Subcommand,
  },{
      name: "ping",
      description: "nh·∫≠n th√¥ng tin v·ªÅ ping c·ªßa bot",
      type: ApplicationCommandOptionType.Subcommand,
  },{
      name: "server",
      description: "nh·∫≠n th√¥ng tin v·ªÅ server c·ªßa b·∫°n",
      type: ApplicationCommandOptionType.Subcommand,
  },{
      name: "userinfo",
      description: "xem th√¥ng tin c·ªßa th√†nh vi√™n trong guilds",
      type: ApplicationCommandOptionType.Subcommand,
      options: [{
          name: "user",
          description: "B·∫°n mu·ªën xem th√¥ng tin c·ªßa ai n√†o?",
          type: ApplicationCommandOptionType.User,
          required: true,
      }],
  },{
      name: "avatar",
      description: "xem avatar ng∆∞·ªùi d√πng",
      type: ApplicationCommandOptionType.Subcommand,
      options: [{
          name: "user",
          description: "B·∫°n mu·ªën xem ·∫£nh ƒë·∫°i di·ªán c·ªßa ai n√†o?",
          type: ApplicationCommandOptionType.Mentionable,
          required: true,
      }],
  },{
      name: "roles",
      description: "nh·∫≠n th√¥ng tin v·ªÅ m·ªôt roles n√†o ƒë√≥",
      type: ApplicationCommandOptionType.Subcommand,
      options: [{
          name: "roles",
          description: "B·∫°n mu·ªën nh·∫≠n th√¥ng tin t·ª´ roles n√†o?",
          type: ApplicationCommandOptionType.Role,
          required: true,
      }],
  },{
      name: "permissions",
      description: "Xem c√°c quy·ªÅn h·∫°n c·ªßa b·∫°n ho·∫∑c c·ªßa th√†nh vi√™n",
      type: ApplicationCommandOptionType.Subcommand,
      options: [{
          name: "user",
          description: "B·∫°n mu·ªën nh·∫≠n th√¥ng tin t·ª´ ai n√†o?",
          type: ApplicationCommandOptionType.User,
          required: true,
      }],
  }],
  run: async(client, interaction) => {
    try {
      if(interaction.options.getSubcommand() === "avatar") {
        const member = interaction.options.getMentionable('user') || interaction.user;
        const avatar = member.displayAvatarURL({ size: 1024, dynamic: true });
        const PNGav = member.displayAvatarURL({ format: 'png', size: 1024 });
        const JPGav = member.displayAvatarURL({ format: 'jpg', size: 1024 });
        const WEBPav = member.displayAvatarURL({ format: 'webp', size: 1024 });
        const embed = new EmbedBuilder().setTitle('üñºÔ∏è Avatar').setColor('Random').setTimestamp().setImage(avatar).setURL(avatar);
        const row1 = new ActionRowBuilder().addComponents(new ButtonBuilder().setLabel('PNG').setStyle(ButtonStyle.Link).setURL(PNGav))
        const row2 = new ActionRowBuilder().addComponents(new ButtonBuilder().setLabel('JPG').setStyle(ButtonStyle.Link).setURL(JPGav))
        const row3 = new ActionRowBuilder().addComponents(new ButtonBuilder().setLabel('DYNAMIC').setStyle(ButtonStyle.Link).setURL(avatar))
        const row4 = new ActionRowBuilder().addComponents(new ButtonBuilder().setLabel('WEBP').setStyle(ButtonStyle.Link).setURL(WEBPav))
        interaction.reply({ embeds: [embed], components: [row1, row2, row3, row4] });
      } else if(interaction.options.getSubcommand() === "roleinfo") {
        var role = interaction.options.getRole("roles");
        if(!role || role == null || role.id == null || !role.id) return interaction?.reply({ content: "kh√¥ng th·ªÉ t√¨m th·∫•y role m√† b·∫°n y√™u c·∫ßu h√£y th·ª≠ l·∫°i m·ªôt l·∫ßn n·ªØa", ephemeral: true });
        const embeduserinfo = new EmbedBuilder()
        embeduserinfo.setThumbnail(interaction.member.guild.iconURL({ dynamic: true, size: 512 }))
        embeduserinfo.setAuthor({ name: `Th√¥ng tin : ${role.name}`, iconURL: `${interaction.member.guild.iconURL({ dynamic: true })}` })
        embeduserinfo.setColor(role.hexColor)
        embeduserinfo.addFields([
          { name: "T√™n roles:", value: `\`${role.name}\`` },
          { name: "ID roles:", value: `\`${role.id}\`` },
          { name: "M√†u roles:", value: `${role.hexColor}` },
          { name: "T·∫°o l√∫c:", value: `<t:${~~(role.createdAt / 1000)}:f>` },
          { name: "V·ªã tr√≠:", value: `\`${role.rawPosition}\`` },
          { name: "S·ªë th√†nh vi√™n c√≥ roles:", value: `\`${role.members.size} C√°c th√†nh vi√™n c√≥ n√≥\`` },
          { name: "ƒê∆∞·ª£c n√¢ng l√™n:", value: `\`${role.hoist ? "‚úîÔ∏è" : "‚ùå"}\`` },
          { name: "C√≥ th·ªÉ h·ªó tr·ª£:", value: `\`${role.mentionable ? "‚úîÔ∏è" : "‚ùå"}\`` },
          { name: "C√°c quy·ªÅn c·ªßa roles:", value: `${role.permissions.toArray().map(p =>`\`${p}\``).join(", ")}` },
        ]);
        interaction?.reply({ embeds: [embeduserinfo] });
      } else if(interaction.options.getSubcommand() === "invite") {
        return interaction.reply({ 
          ephemeral: true,
          embeds: [new EmbedBuilder()
            .setColor("Random")
            .setFooter({ text: client.user.username, iconURL: interaction.member.guild.iconURL({ dynamic: true }) })
            .setDescription(`[B·∫•m v√†o ƒë√¢y ƒë·ªÉ m·ªùi t√¥i!](https://discord.com/api/oauth2/authorize?client_id=${client.user.id}&permissions=8&scope=bot%20applications.commands)\n\n||[Nh·∫•p v√†o ƒë√¢y ƒë·ªÉ m·ªùi t√¥i m√† kh√¥ng c√≥ L·ªánh Slash!](https://discord.com/api/oauth2/authorize?client_id=${client.user.id}&permissions=8&scope=bot)||`)]
        });
      } else if(interaction.options.getSubcommand() === "ping") {
        const pingImageArr = [
         "https://cdn.discordapp.com/attachments/892794857905602560/892794900863660062/63e1657a8a6249a2fc9c062b17f27ce0.gif",
         "https://cdn.discordapp.com/attachments/892794857905602560/892795017104613376/dc87c9ea90b4b7d02a0cbe5de256d385.gif",
         "https://cdn.discordapp.com/attachments/892794857905602560/892795143093108806/a665463e60ef772c82286e4ee6a15353.gif",
         "https://cdn.discordapp.com/attachments/892794857905602560/892795222986207293/4a3a4f44524556704c29879feeba0c23.gif",
         "https://cdn.discordapp.com/attachments/892794857905602560/892795292573913098/534d38d35eb761ad11e43fe378c3de29.gif",
         "https://cdn.discordapp.com/attachments/892794857905602560/892795346172928080/c17166b2af1a743b149e1eb0f3203db4.gif",
         "https://cdn.discordapp.com/attachments/892794857905602560/892795432797872188/6619fe492c713eb3051ab7568181dbdd.gif"
         ];
        const Loading = pingImageArr[Math.floor(Math.random() * pingImageArr.length)];
        const Ping = client.ws.ping;
        var Color;
        if (Ping <= 300) {
           Color = "#00ff00";
        } else if(Ping > 300 && Ping < 600) {
           Color = "#ffff00";
        } else if(Ping >= 600 && Ping < 900) {
           Color = "#ffa500";
        } else if(Ping >= 900) {
           Color = "#ff0000";
        };
        const loadingEmbed = new EmbedBuilder()
        .setTitle('üèì Pong')
        .setDescription('***ƒêang t·∫£i d·ªØ li·ªáu...***')
        .setThumbnail(Loading)
        .setColor('#ffffff');
       const pingEmbed = new EmbedBuilder()
        .setTitle('üèì Pong')
        .setColor(Color)
        .addFields([
          { name: 'Nh·ªãp websocket', value: `\`\`\`yaml\n${Ping} Ms\`\`\``, inline: true },
          { name: 'ƒê·ªô tr·ªÖ kh·ª© h·ªìi', value: `\`\`\`yaml\n${Math.abs(interaction.createdTimestamp - Date.now())} Ms\`\`\``, inline: true },
          { name: 'ƒê·ªô tr·ªÖ API', value: `\`\`\`yaml\n${Math.round(client.ws.ping)} Ms\`\`\``, inline: true },
          { name: 'S·ª≠ d·ª•ng b·ªô nh·ªõ', value: `\`\`\`yaml\n${(process.memoryUsage().heapUsed / 1024 / 1024).toFixed(2)} MB\`\`\``, inline: true },
        ]);
       interaction.reply({ embeds: [loadingEmbed] }).then(() => {
          setTimeout(() => interaction.editReply({ embeds: [pingEmbed] }), 1001);
       });
      } else if(interaction.options.getSubcommand() === "server") {
        let boosts = interaction.guild.premiumSubscriptionCount;
        var boostlevel = 0;
        if(boosts >= 2) boostlevel = "1";
        if(boosts >= 7) boostlevel = "2";
        if(boosts >= 14) boostlevel = "3";
        const Thong_tin_server = new EmbedBuilder()
            .setColor("Random")
            .setAuthor({ name: `Server: ${interaction.guild.name}`, iconURL: client.user.displayAvatarURL() })
            .setDescription(interaction.guild.description || "Kh√¥ng c√≥ m√¥ t·∫£")
            .setThumbnail(interaction.guild.iconURL())
            .addFields([
                { name: "> T√™n server", value: interaction.guild.name, inline: true },
                { name: "> ID", value: interaction.guild.id, inline: true },
                { name: "> Boost", value: `${boostlevel}[${boosts}]`, inline: true },
                { name: "> Ch·ªß server", value: `${interaction.client.users.cache.get(interaction.guild.ownerId)}`, inline: true },
                { name: "> Th√†nh Vi√™n", value: `T·ªïng s·ªë: ${interaction.guild.memberCount}\nTh√†nh vi√™n: ${interaction.guild.members.cache.filter((m) => !m.user.bot).size}\nBot: ${interaction.guild.members.cache.filter((m) => m.user.bot).size}`, inline: true },
                { name: "> Kh√°c", value: `Roles: ${interaction.guild.roles.cache.size}\nEmojis: ${interaction.guild.emojis.cache.size}\n Stickers: ${interaction.guild.stickers.cache.size}`, inline: true },
                { name: "> K√™nh", value: `Category: ${interaction.guild.channels.cache.filter((channel) => channel.type == ChannelType.GuildCategory).size}\nText Channel: ${interaction.guild.channels.cache.filter((channel) => channel.type == ChannelType.GuildText).size}\nVoice Channel: ${interaction.guild.channels.cache.filter((channel) => channel.type == ChannelType.GuildVoice).size}\nStage: ${interaction.guild.channels.cache.filter((channel) => channel.type == ChannelType.GuildStageVoice).size}`, inline: true },
                { name: "> Ng√†y b·∫°n tham gia", value: `<t:${parseInt(interaction.guild.createdAt / 1000)}:F>(<t:${parseInt(interaction.guild.createdAt / 1000)}:R>)`, inline: true }
            ]);
        interaction.reply({ embeds: [Thong_tin_server] });
      } else if(interaction.options.getSubcommand() === "userinfo") {
        const member = await interaction.guild.members.fetch(interaction.options.getUser('user').id);
        if(!member) return interaction.reply({ content: "Ng∆∞·ªùi d√πng n√†y kh√¥ng ·ªü trong guilds" });
        const badgeFlags = {
          DEVELOPER: "üë®‚Äçüíª",
          BUGS: "üêõ",
          MANAGEMENT: "üëë",
          PREMIUM: "üëë",
          SUPPORTER: "üë®‚Äçüîß",
          TEAM: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶",
          BOOSTER: "üöÄ",
          PARTNER: "ü§ù",
          VOTER: "üó≥Ô∏è",
          SUPPORT: "üîß",
          MODERATOR: "üëÆ‚Äç‚ôÇÔ∏è",
          DESIGNER: "üé®",
          MARKETING: "üìà"
        };
        const flags = {
          ActiveDeveloper: "üë®‚Äçüíª„ÉªActive Developer",
          BugHunterLevel1: "üêõ„ÉªDiscord Bug Hunter",
          BugHunterLevel2: "üêõ„ÉªDiscord Bug Hunter",
          CertifiedModerator: "üëÆ‚Äç‚ôÇÔ∏è„ÉªCertified Moderator",
          HypeSquadOnlineHouse1: "üè†„ÉªHouse Bravery Member",
          HypeSquadOnlineHouse2: "üè†„ÉªHouse Brilliance Member",
          HypeSquadOnlineHouse3: "üè†„ÉªHouse Balance Member",
          HypeSquadEvents: "üè†„ÉªHypeSquad Events",
          PremiumEarlySupporter: "üëë„ÉªEarly Supporter",
          Partner: "üëë„ÉªPartner",
          Quarantined: "üîí„ÉªQuarantined", // Kh√¥ng ch·∫Øc ch·∫Øn c√°i n√†y c√≤n ho·∫°t ƒë·ªông :))
          Spammer: "üîí„ÉªSpammer", // Kh√¥ng ch·∫Øc ch·∫Øn c√°i n√†y c√≤n ho·∫°t ƒë·ªông :)
          Staff: "üë®‚Äçüíº„ÉªDiscord Staff",
          TeamPseudoUser: "üë®‚Äçüíº„ÉªDiscord Team",
          VerifiedBot: "ü§ñ„ÉªVerified Bot",
          VerifiedDeveloper: "üë®‚Äçüíª„Éª(early)Verified Bot Developer",
        };
        const roles = member.roles.cache.sort((a, b) => b.position - a.position).map(role => role.toString()).slice(0, -1);
        const userFlags = member.user.flags ? member.user.flags.toArray() : [];
        return interaction.reply({ embeds: [new EmbedBuilder()
           .setTitle("Xem th√¥ng tin ng∆∞·ªùi d√πng")
           .setThumbnail(member.user.displayAvatarURL({ dynamic: true, size: 1024 }))
           .setDescription(`Th√¥ng tin v·ªÅ ${member.user.username}`)
           .setImage(member.user.bannerURL({ dynamic: true, size: 1024 }))
           .addFields([
             { name: "t√™n th√†nh vi√™n", value: `${member.user.username}`, inline: true },
             { name: "S·ªë ƒë·ªãnh danh", value: `${member.user.discriminator}`, inline: true },
             { name: "Bi·ªát danh", value: `${member.nickname || 'kh√¥ng c√≥ bi·ªát danh'}`, inline: true },
             { name: "Id", value: `${member.user.id}`, inline: true },
             { name: "Huy hi·ªáu c·ªßa th√†nh vi√™n", value: `${userFlags.length ? userFlags.map(flag => flags[flag]).join(', ') : 'Kh√¥ng c√≥'}`, inline: true },
             { name: "Ng√†y tham gia discord", value: `<t:${Math.round(member.user.createdTimestamp / 1000)}>`, inline: true },
             { name: "Ng√†y tham gia server", value: `<t:${Math.round(member.joinedAt / 1000)}>`, inline: true },
             { name: `Roles [${roles.length}]`, value: `${roles.length ? roles.join(', ') : 'Kh√¥ng c√≥'}`, inline: false }
           ])                     
        ]});
      } else if(interaction.options.getSubcommand() === "permissions") {
        const Member = interaction.options.getMember("user")
        const USER = interaction.options.getUser("user")

        let Embed = new EmbedBuilder().setColor("DarkRed");
        if(!Member) return interaction.reply({
            embeds: [Embed.setDescription("Th√†nh vi√™n kh√¥ng th·ªÉ ƒë∆∞·ª£c t√¨m th·∫•y")], ephemeral: true
        });
        return interaction.reply({ embeds: [new EmbedBuilder()
            .setColor("Blue")
            .setTitle(`üõ† | Permissions`)
            .setDescription(`Permissions c·ªßa ${Member}\`\`\`CreateInstantInvite ${Member.permissions.has([PermissionFlagsBits.CreateInstantInvite]) ? "‚úÖ" : "‚ùå"}\
            \nKickMembers ${Member.permissions.has([PermissionFlagsBits.KickMembers]) ? "‚úÖ" : "‚ùå"}\
            \nBanMember ${Member.permissions.has([PermissionFlagsBits.BanMembers]) ? "‚úÖ" : "‚ùå"}\
            \nAdministrator ${Member.permissions.has([PermissionFlagsBits.Administrator]) ? "‚úÖ" : "‚ùå"}\
            \nManageChannels ${Member.permissions.has([PermissionFlagsBits.ManageChannels]) ? "‚úÖ" : "‚ùå"}\
            \nManageGuild ${Member.permissions.has([PermissionFlagsBits.ManageGuild]) ? "‚úÖ" : "‚ùå"}\
            \nAddReactions ${Member.permissions.has([PermissionFlagsBits.AddReactions]) ? "‚úÖ" : "‚ùå"}\
            \nViewAuditLog ${Member.permissions.has([PermissionFlagsBits.ViewAuditLog]) ? "‚úÖ" : "‚ùå"}\
            \nPrioritySpeaker ${Member.permissions.has([PermissionFlagsBits.PrioritySpeaker]) ? "‚úÖ" : "‚ùå"}\
            \nStream ${Member.permissions.has([PermissionFlagsBits.Stream]) ? "‚úÖ" : "‚ùå"}\
            \nViewChannel ${Member.permissions.has([PermissionFlagsBits.ViewChannel]) ? "‚úÖ" : "‚ùå"}\
            \nSendMessages ${Member.permissions.has([PermissionFlagsBits.SendMessages]) ? "‚úÖ" : "‚ùå"}\
            \nSendTTSMessages ${Member.permissions.has([PermissionFlagsBits.SendTTSMessages]) ? "‚úÖ" : "‚ùå"}\
            \nManageMessages ${Member.permissions.has([PermissionFlagsBits.ManageMessages]) ? "‚úÖ" : "‚ùå"}\
            \nEmbedLinks ${Member.permissions.has([PermissionFlagsBits.EmbedLinks]) ? "‚úÖ" : "‚ùå"}\
            \nAttachFiles ${Member.permissions.has([PermissionFlagsBits.AttachFiles]) ? "‚úÖ" : "‚ùå"}\
            \nReadMessageHistory ${Member.permissions.has([PermissionFlagsBits.ReadMessageHistory]) ? "‚úÖ" : "‚ùå"}\
            \nMentionEveryone ${Member.permissions.has([PermissionFlagsBits.MentionEveryone]) ? "‚úÖ" : "‚ùå"}\
            \nUseExternalEmojis ${Member.permissions.has([PermissionFlagsBits.UseExternalEmojis]) ? "‚úÖ" : "‚ùå"}\
            \nViewGuildInsights ${Member.permissions.has([PermissionFlagsBits.ViewGuildInsights]) ? "‚úÖ" : "‚ùå"}\
            \nConnect ${Member.permissions.has([PermissionFlagsBits.Connect]) ? "‚úÖ" : "‚ùå"}\
            \nSpeak ${Member.permissions.has([PermissionFlagsBits.Speak]) ? "‚úÖ" : "‚ùå"}\
            \nMuteMembers ${Member.permissions.has([PermissionFlagsBits.MuteMembers]) ? "‚úÖ" : "‚ùå"}\
            \nDeafenMembers ${Member.permissions.has([PermissionFlagsBits.DeafenMembers]) ? "‚úÖ" : "‚ùå"}\
            \nMoveMembers ${Member.permissions.has([PermissionFlagsBits.MoveMembers]) ? "‚úÖ" : "‚ùå"}\
            \nUseVAD ${Member.permissions.has([PermissionFlagsBits.UseVAD]) ? "‚úÖ" : "‚ùå"}\
            \nChangeNickname ${Member.permissions.has([PermissionFlagsBits.ChangeNickname]) ? "‚úÖ" : "‚ùå"}\
            \nManageNicknames ${Member.permissions.has([PermissionFlagsBits.ManageNicknames]) ? "‚úÖ" : "‚ùå"}\
            \nManageRoles ${Member.permissions.has([PermissionFlagsBits.ManageRoles]) ? "‚úÖ" : "‚ùå"}\
            \nManageWebhooks ${Member.permissions.has([PermissionFlagsBits.ManageWebhooks]) ? "‚úÖ" : "‚ùå"}\
            \nManageEmojisAndStickers ${Member.permissions.has([PermissionFlagsBits.ManageEmojisAndStickers]) ? "‚úÖ" : "‚ùå"}\
            \nUseApplicationCommands ${Member.permissions.has([PermissionFlagsBits.UseApplicationCommands]) ? "‚úÖ" : "‚ùå"}\
            \nRequestToSpeak ${Member.permissions.has([PermissionFlagsBits.RequestToSpeak]) ? "‚úÖ" : "‚ùå"}\
            \nManageEvents ${Member.permissions.has([PermissionFlagsBits.ManageEvents]) ? "‚úÖ" : "‚ùå"}\
            \nManageThreads ${Member.permissions.has([PermissionFlagsBits.ManageThreads]) ? "‚úÖ" : "‚ùå"}\
            \nCreatePublicThreads ${Member.permissions.has([PermissionFlagsBits.CreatePublicThreads]) ? "‚úÖ" : "‚ùå"}\
            \nCreatePrivateThreads ${Member.permissions.has([PermissionFlagsBits.CreatePrivateThreads]) ? "‚úÖ" : "‚ùå"}\
            \nUseExternalStickers ${Member.permissions.has([PermissionFlagsBits.UseExternalStickers]) ? "‚úÖ" : "‚ùå"}\
            \nSendMessagesInThreads ${Member.permissions.has([PermissionFlagsBits.SendMessagesInThreads]) ? "‚úÖ" : "‚ùå"}\
            \nUseEmbeddedActivities ${Member.permissions.has([PermissionFlagsBits.UseEmbeddedActivities]) ? "‚úÖ" : "‚ùå"}\
            \nModerateMembers ${Member.permissions.has([PermissionFlagsBits.ModerateMembers]) ? "‚úÖ" : "‚ùå"}\
            \n\`\`\``)
            .setFooter({ text: `${USER.tag}`, iconURL: Member.displayAvatarURL() })
            .setTimestamp()],
        });
      };
    } catch (e) {
      console.log(String(e.stack).bgRed);
    };
  },
}